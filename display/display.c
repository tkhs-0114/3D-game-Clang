#include "display.h"
#include <locale.h>
#include <math.h>
#include <ncursesw/ncurses.h>
#include <stdlib.h>
#include <wchar.h>

#define CHAR_LENGTH 39

typedef struct char_data {
  char ch;
  bool data[10][10];
} char_data;

char_data c_data[CHAR_LENGTH] = {
    {'-',
     {{0, 0, 0, 0, 0},
      {0, 0, 0, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 0, 1, 0},
      {1, 1, 1, 1, 1},
      {0, 0, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 0, 0, 0},
      {0, 0, 0, 0, 0}}},
    {':',
     {{0, 0, 0, 0, 0},
      {0, 0, 1, 1, 0},
      {0, 0, 1, 1, 0},
      {0, 0, 0, 0, 0},
      {0, 0, 0, 0, 0},
      {0, 0, 1, 1, 0},
      {0, 0, 1, 1, 0},
      {0, 0, 0, 0, 0},
      {0, 0, 0, 0, 0}}},
    {'A',
     {{0, 0, 1, 0, 0},
      {0, 1, 0, 1, 0},
      {0, 1, 0, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 1, 1, 1, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'B',
     {{1, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'C',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'D',
     {{1, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'E',
     {{1, 1, 1, 1, 1},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 1},
      {0, 0, 0, 0, 0}}},
    {'F',
     {{1, 1, 1, 1, 1},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {0, 0, 0, 0, 0}}},
    {'G',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 1, 1, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'H',
     {{1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 1, 1, 1, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'I',
     {{1, 1, 1, 1, 1},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {1, 1, 1, 1, 1},
      {0, 0, 0, 0, 0}}},
    {'J',
     {{0, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'K',
     {{1, 0, 0, 0, 1},
      {1, 0, 0, 1, 0},
      {1, 0, 1, 0, 0},
      {1, 1, 0, 0, 0},
      {1, 0, 1, 0, 0},
      {1, 0, 0, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'L',
     {{1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 1},
      {0, 0, 0, 0, 0}}},
    {'M',
     {{1, 0, 0, 0, 1},
      {1, 1, 0, 1, 1},
      {1, 0, 1, 0, 1},
      {1, 0, 1, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'N',
     {{1, 0, 0, 0, 1},
      {1, 1, 0, 0, 1},
      {1, 0, 1, 0, 1},
      {1, 0, 0, 1, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'O',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'P',
     {{1, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 1, 1, 1, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {0, 0, 0, 0, 0}}},
    {'Q',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 1, 0, 1},
      {1, 0, 0, 1, 0},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 1},
      {0, 0, 0, 0, 0}}},
    {'R',
     {{1, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 1, 1, 1, 0},
      {1, 0, 1, 0, 0},
      {1, 0, 0, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'S',
     {{0, 1, 1, 1, 1},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'T',
     {{1, 1, 1, 1, 1},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 0, 0, 0}}},
    {'U',
     {{1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'V',
     {{1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 0, 1, 0},
      {0, 1, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 0, 0, 0}}},
    {'W',
     {{1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 1, 0, 1},
      {1, 0, 1, 0, 1},
      {1, 1, 0, 1, 1},
      {1, 1, 0, 1, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'X',
     {{1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 0, 1, 0},
      {0, 1, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 1, 0, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 0}}},
    {'Y',
     {{1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 0, 0, 0}}},
    {'Z',
     {{1, 1, 1, 1, 1},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 1, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 1},
      {0, 0, 0, 0, 0}}},
    {'Z',
     {{1, 1, 1, 1, 1},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 1, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 1},
      {0, 0, 0, 0, 0}}},
    {'0',
     {{0, 0, 1, 1, 0},
      {0, 1, 0, 0, 1},
      {0, 1, 0, 0, 1},
      {0, 1, 0, 0, 1},
      {0, 1, 0, 0, 1},
      {0, 1, 0, 0, 1},
      {0, 1, 0, 0, 1},
      {0, 0, 1, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'1',
     {{0, 0, 1, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 0, 0}}},
    {'2',
     {{0, 0, 1, 1, 0},
      {0, 1, 0, 0, 1},
      {0, 1, 0, 0, 1},
      {0, 0, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 1, 0, 0, 0},
      {0, 1, 0, 0, 0},
      {0, 1, 1, 1, 1},
      {0, 0, 0, 0, 0}}},
    {'3',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {0, 0, 1, 1, 0},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},

    {'4',
     {{0, 0, 0, 1, 0},
      {0, 0, 1, 1, 0},
      {0, 1, 0, 1, 0},
      {1, 0, 0, 1, 0},
      {1, 1, 1, 1, 1},
      {0, 0, 0, 1, 0},
      {0, 0, 0, 1, 0},
      {0, 0, 1, 1, 1},
      {0, 0, 0, 0, 0}}},

    {'5',
     {{1, 1, 1, 1, 1},
      {1, 0, 0, 0, 0},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 0},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},

    {'6',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 0},
      {1, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},

    {'7',
     {{1, 1, 1, 1, 1},
      {0, 0, 0, 0, 1},
      {0, 0, 0, 1, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 1, 0, 0},
      {0, 0, 0, 0, 0}}},

    {'8',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},

    {'9',
     {{0, 1, 1, 1, 0},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 1},
      {0, 0, 0, 0, 1},
      {1, 0, 0, 0, 1},
      {0, 1, 1, 1, 0},
      {0, 0, 0, 0, 0}}},

};

void print_display(int display[H][W]) {
  for (int i = 0; i < H; i++) {
    move(i, 0);
    for (int j = 0; j < W; j++) {
      addch(' ' | COLOR_PAIR(display[i][j]));
      addch(' ' | COLOR_PAIR(display[i][j]));
    }
  }
  refresh();
}
void clear_display(int display[H][W], int color) {
  for (int i = 0; i < H; i++) {
    for (int j = 0; j < W; j++) {
      display[i][j] = color;
    }
  }
}
void draw_line(int display[H][W], int x1, int y1, int x2, int y2, int color) {
  int dx = abs(x2 - x1);
  int dy = abs(y2 - y1);

  int sx = (x1 < x2) ? 1 : -1;
  int sy = (y1 < y2) ? 1 : -1;

  int err = dx - dy;
  while (1) {
    if (y1 >= 0 && y1 < H && x1 >= 0 && x1 < W)
      display[y1][x1] = color;

    if (x1 == x2 && y1 == y2)
      break;

    int e2 = err << 1; // 2 * err をビットシフトで高速化
    if (e2 > -dy) {
      err -= dy;
      x1 += sx;
    }
    if (e2 < dx) {
      err += dx;
      y1 += sy;
    }
  }
}
void draw_char(int display[H][W], int x, int y, char ch, int color, int s) {
  if (y >= 0 && y < H - 9 * s && x >= 0 && x < W - 9) {
    for (int i = 0; i < CHAR_LENGTH; i++) {
      if (c_data[i].ch == ch) {
        for (int j = 0; j < 9 * s; j++) {
          for (int k = 0; k < 5 * s * 2; k++) {
            if (c_data[i].data[j / s][k / (s * 2)]) {
              display[y + j][x + k] = color;
            }
          }
        }
      }
    }
  }
}
void draw_text(int display[H][W], int x, int y, const char *text, int s,
               int color) {
  for (int i = 0; text[i] != '\0'; i++) {
    draw_char(display, x + (i * 12 * s), y, text[i], color, s);
  }
}
void draw_bar(int display[H][W], int x, int y, double p, int color) {
  draw_line(display, x, y, W - x, y, color);
  draw_line(display, W - x, y, W - x, y + 10, color);
  draw_line(display, W - x, y + 10, x, y + 10, color);
  draw_line(display, x, y + 10, x, y, color);
  for (int i = x; i < x + (W - x * 2) * p; i++) {
    draw_line(display, i, y + 1, i, y + 9, color);
  }
}
//